<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="teamProject.food114.mapper.CustomerMapper">
	<insert id="insertConsumer" parameterType="hashmap">
		INSERT INTO
		FOOD114_CONSUMER
		VALUES(#{userId},#{pwd},#{userName},#{nickName},#{gender},#{birthMD},#{phone},concat(#{email},'@',
		<choose>
			<when test="emailAddr!=''">
				#{emailAddr}
			</when>
			<otherwise>
				#{emailAddrInput}
			</otherwise>
		</choose>
		),"1",now(),now(),"N","Y")
	</insert>
	<select id="selectUserID" parameterType="hashmap"
		resultType="teamProject.food114.model.Customer">
		SELECT *
		FROM FOOD114_CONSUMER
		WHERE USERID=#{userId}
	</select>
	<select id="selectUserAddr" parameterType="hashmap"
		resultType="teamProject.food114.model.Addr">
		SELECT *
		FROM FOOD114_CONSUMER_ADDR
		WHERE USERID=#{userId}
	</select>
	<select id="selectEmail" parameterType="hashmap"
		resultType="teamProject.food114.model.Customer">
		SELECT * FROM FOOD114_CONSUMER WHERE EMAIL=concat(#{email},"@",
		<choose>
			<when test="emailAddr!=''">
				#{emailAddr}
			</when>
			<otherwise>
				#{emailAddrInput}
			</otherwise>
		</choose>
		)
	</select>

	<!-- myInfo 수정 -->
	<update id="updateMyInfo" parameterType="hashmap">
		UPDATE FOOD114_CUSTOMER
		SET
		NAME = #{name},
		NICKNAME = #{nickName},
		PHONE = #{phone},
		EMAIL = #{email}
		WHERE USERID = #{userId}
	</update>

	<select id="selectUserSiGuDong" parameterType="hashmap"
		resultType="teamProject.food114.model.CustomerAddr">
		SELECT
		*
		FROM
		FOOD114_CONSUMER_ADDR A1
		INNER JOIN FOOD114_AREA A2 ON A1.OLDADDR LIKE CONCAT('%', A2.SI, '%')
		AND A1.OLDADDR LIKE CONCAT('%', A2.GU, '%')
		AND A1.OLDADDR LIKE CONCAT('%', A2.DONG, '%');
	</select>

</mapper>